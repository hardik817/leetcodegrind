SELECT 
    b.book_id,b.title,b.author,b.genre,b.pages,
    
    MAX(r.session_rating) - MIN(r.session_rating) AS rating_spread,
    ROUND(
        SUM(r.session_rating >= 4 OR r.session_rating <= 2) / COUNT(r.session_id),
        2
    ) AS polarization_score
FROM books AS b
JOIN reading_sessions AS r
    ON b.book_id = r.book_id
GROUP BY b.book_id
HAVING 
    COUNT(r.session_id) >= 5
    AND MAX(r.session_rating) >= 4
    AND MIN(r.session_rating) <= 2
    AND (SUM(r.session_rating >= 4 OR r.session_rating <= 2) / COUNT(r.session_id)) >= 0.6
ORDER BY polarization_score DESC, b.title DESC;
